# Copyright 2025 the original author or authors.
# <p>
# Licensed under the Moderne Source Available License (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
# <p>
# https://docs.moderne.io/licensing/moderne-source-available-license
# <p>
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
---
type: specs.openrewrite.org/v1beta/example
recipeName: org.openrewrite.github.AddManualTrigger
examples:
- description: '`AddManualTriggerTest#manualTrigger`'
  sources:
  - before: |
      on:
        push:
          branches:
            - main
      env:
        TEST: 'value'
    after: |
      on:
        push:
          branches:
            - main
        workflow_dispatch:
      env:
        TEST: 'value'
    path: .github/workflows/ci.yml
    language: yaml
---
type: specs.openrewrite.org/v1beta/example
recipeName: org.openrewrite.github.AutoCancelInProgressWorkflow
examples:
- description: '`AutoCancelInProgressWorkflowTest#useDefaultAccessToken`'
  parameters:
  - 'null'
  sources:
  - before: |
      jobs:
        build:
          runs-on: linux
          steps:
            - uses: actions/checkout@v2
    after: |
      jobs:
        build:
          runs-on: linux
          steps:
            - uses: styfle/cancel-workflow-action@0.9.1
              with:
                access_token: ${{ github.token }}
            - uses: actions/checkout@v2
    path: .github/workflows/ci.yml
    language: yaml
---
type: specs.openrewrite.org/v1beta/example
recipeName: org.openrewrite.github.ChangeAction
examples:
- description: '`ChangeActionTest#changeActionInSteps`'
  parameters:
  - gradle/wrapper-validation-action
  - gradle/actions/wrapper-validation
  - v3
  sources:
  - before: |
      jobs:
        deploy:
          runs-on: ubuntu-latest
          steps:
            - name: Checkout
              uses: actions/checkout@v4
            - name: Validate wrapper
              uses: gradle/wrapper-validation-action@v2
    after: |
      jobs:
        deploy:
          runs-on: ubuntu-latest
          steps:
            - name: Checkout
              uses: actions/checkout@v4
            - name: Validate wrapper
              uses: gradle/actions/wrapper-validation@v3
    path: .github/workflows/ci.yml
    language: yaml
---
type: specs.openrewrite.org/v1beta/example
recipeName: org.openrewrite.github.ChangeActionVersion
examples:
- description: '`ChangeActionVersionTest#updateActionVersion`'
  parameters:
  - actions/setup-java
  - v4
  sources:
  - before: |
      jobs:
        build:
          runs-on: ubuntu-latest
          steps:
            - uses: actions/checkout@v2
            - uses: actions/setup-java@main
    after: |
      jobs:
        build:
          runs-on: ubuntu-latest
          steps:
            - uses: actions/checkout@v2
            - uses: actions/setup-java@v4
    path: .github/workflows/ci.yml
    language: yaml
---
type: specs.openrewrite.org/v1beta/example
recipeName: org.openrewrite.github.ChangeDependabotScheduleInterval
examples:
- description: '`ChangeDependabotScheduleIntervalTest#changeDependabotScheduleInterval`'
  parameters:
  - github-actions
  - weekly
  sources:
  - before: |
      version: 2
      updates:
        - package-ecosystem: github-actions
          directory: /
          schedule:
            interval: daily
        - package-ecosystem: maven
          directory: /
          schedule:
            interval: weekly
        - package-ecosystem: gradle
          directory: /
          schedule:
            interval: monthly
    after: |
      version: 2
      updates:
        - package-ecosystem: github-actions
          directory: /
          schedule:
            interval: weekly
        - package-ecosystem: maven
          directory: /
          schedule:
            interval: weekly
        - package-ecosystem: gradle
          directory: /
          schedule:
            interval: monthly
    path: .github/dependabot.yml
    language: yaml
---
type: specs.openrewrite.org/v1beta/example
recipeName: org.openrewrite.github.FindMissingTimeout
examples:
- description: '`FindMissingTimeoutTest#findMissingTimeout`'
  sources:
  - before: |
      jobs:
        build:
          runs-on: ubuntu-latest
          steps:
            - uses: actions/checkout@v2
            - name: Run a one-line script
              run: echo Hello, world!
    after: |
      jobs:
        ~~(missing: $.jobs.*.timeout-minutes)~~>build:
          runs-on: ubuntu-latest
          steps:
            - uses: actions/checkout@v2
            - name: Run a one-line script
              run: echo Hello, world!
    path: .github/workflows/build.yml
    language: yaml
---
type: specs.openrewrite.org/v1beta/example
recipeName: org.openrewrite.github.MigrateSetupUvV6ToV7
examples:
- description: '`MigrateSetupUvV6ToV7Test#upgradesVersionFromV6ToV7`'
  sources:
  - before: |
      jobs:
        build:
          steps:
            - uses: astral-sh/setup-uv@v6
              with:
                version: "0.5.13"
    after: |
      jobs:
        build:
          steps:
            - uses: astral-sh/setup-uv@v7
              with:
                version: "0.5.13"
    path: .github/workflows/ci.yml
    language: yaml
---
type: specs.openrewrite.org/v1beta/example
recipeName: org.openrewrite.github.PreferSecretsInheritWorkflow
examples:
- description: '`PreferSecretsInheritWorkflowTest#replaceIdenticalSecretsWithInherit`'
  sources:
  - before: |
      jobs:
        call-workflow-passing-data:
          uses: octo-org/example-repo/.github/workflows/reusable-workflow.yml@main
          with:
            config-path: .github/labeler.yml
          secrets:
            envPAT: ${{ secrets.envPAT }}
    after: |
      jobs:
        call-workflow-passing-data:
          uses: octo-org/example-repo/.github/workflows/reusable-workflow.yml@main
          with:
            config-path: .github/labeler.yml
          secrets: inherit
    path: .github/workflows/ci.yml
    language: yaml
---
type: specs.openrewrite.org/v1beta/example
recipeName: org.openrewrite.github.PreferTemurinDistributions
examples:
- description: '`PreferTemurinDistributionsTest#changesWhenAllAreHosted`'
  sources:
  - before: |
      jobs:
        build:
          runs-on: [ubuntu-latest,macos-latest]
          steps:
            - uses: actions/checkout@v2
              with:
                fetch-depth: 0
            - name: set-up-jdk-0
              uses: actions/setup-java@v2.3.0
              with:
                distribution: "zulu"
                java-version: "11"
            - name: set-up-jdk-1
              uses: actions/setup-java@v2.3.0
              with:
                distribution: "adopt"
                java-version: "17"
            - name: set-up-jdk-2
              uses: actions/setup-java@v2.3.0
              with:
                distribution: "zulu"
                java-version: "8"
            - name: build
              run: ./gradlew build test
    after: |
      jobs:
        build:
          runs-on: [ubuntu-latest,macos-latest]
          steps:
            - uses: actions/checkout@v2
              with:
                fetch-depth: 0
            - name: set-up-jdk-0
              uses: actions/setup-java@v2.3.0
              with:
                distribution: "temurin"
                java-version: "11"
            - name: set-up-jdk-1
              uses: actions/setup-java@v2.3.0
              with:
                distribution: "temurin"
                java-version: "17"
            - name: set-up-jdk-2
              uses: actions/setup-java@v2.3.0
              with:
                distribution: "temurin"
                java-version: "8"
            - name: build
              run: ./gradlew build test
    path: .github/workflows/ci.yml
    language: yaml
---
type: specs.openrewrite.org/v1beta/example
recipeName: org.openrewrite.github.RemoveAllCronTriggers
examples:
- description: '`RemoveAllCronTriggerTest#removeCronTrigger`'
  sources:
  - before: |
      on:
        push:
          branches:
            - main
        schedule:
          - cron: "0 18 * * *"
          - cron: "0 11 * * *"
    after: |
      on:
        push:
          branches:
            - main
    path: .github/workflows/ci.yml
    language: yaml
---
type: specs.openrewrite.org/v1beta/example
recipeName: org.openrewrite.github.RemoveUnusedWorkflowDispatchInputs
examples:
- description: '`RemoveUnusedWorkflowDispatchInputsTest#removeUnusedInputs`'
  sources:
  - before: |
      name: Test Workflow
      on:
        workflow_dispatch:
          inputs:
            used-input:
              description: 'This input is used'
              required: true
            unused_input:
              description: 'This input is not used anywhere'
              required: false
            anotherUnusedInput:
              description: 'Also not used'
              default: 'default-value'
            usedInGithubActionSyntax:
              description: 'Used in Github Action syntax'

      jobs:
        test-job:
          runs-on: ubuntu-latest
          steps:
            - name: Use input
              run: echo "Used input - ${{ github.event.inputs.used-input }}"
            - name: Another step
              run: echo "Just a step without input reference"
            - name: Step 3
              if: inputs . usedInGithubActionSyntax == 'true'
              run: echo "Conditional step"
    after: |
      name: Test Workflow
      on:
        workflow_dispatch:
          inputs:
            used-input:
              description: 'This input is used'
              required: true
            usedInGithubActionSyntax:
              description: 'Used in Github Action syntax'

      jobs:
        test-job:
          runs-on: ubuntu-latest
          steps:
            - name: Use input
              run: echo "Used input - ${{ github.event.inputs.used-input }}"
            - name: Another step
              run: echo "Just a step without input reference"
            - name: Step 3
              if: inputs . usedInGithubActionSyntax == 'true'
              run: echo "Conditional step"
    path: .github/workflows/test.yml
    language: yaml
---
type: specs.openrewrite.org/v1beta/example
recipeName: org.openrewrite.github.RemoveWorkflowInputArgument
examples:
- description: '`RemoveWorkflowInputArgumentTest#removeWorkflowInputArgument`'
  parameters:
  - org/repo/.github/workflows/myWorkflow.yml
  - v1.2.3
  - myInputToRemove
  sources:
  - before: |
      name: My workflow
      on: workflow_dispatch
      jobs:
        call-workflow:
          uses: org/repo/.github/workflows/myWorkflow.yml@v1.2.3
          with:
            myInputToRemove: "value to remove"
            keepThisInput: "keep this value"
            anotherInput: "also keep this"
    after: |
      name: My workflow
      on: workflow_dispatch
      jobs:
        call-workflow:
          uses: org/repo/.github/workflows/myWorkflow.yml@v1.2.3
          with:
            keepThisInput: "keep this value"
            anotherInput: "also keep this"
    path: .github/workflows/caller.yml
    language: yaml
---
type: specs.openrewrite.org/v1beta/example
recipeName: org.openrewrite.github.ReplaceRunners
examples:
- description: '`ReplaceRunnersTest#replaceRunners`'
  parameters:
  - build
  - List.of("ubuntu-latest", "MyRunner")
  sources:
  - before: |
      jobs:
        build:
          runs-on: ubuntu-latest
        other:
          runs-on: ubuntu-latest
    after: |
      jobs:
        build:
          runs-on: [ubuntu-latest, MyRunner]
        other:
          runs-on: ubuntu-latest
    path: .github/workflows/ci.yml
    language: yaml
---
type: specs.openrewrite.org/v1beta/example
recipeName: org.openrewrite.github.ReplaceSecrets
examples:
- description: '`ReplaceSecretsTest#replaceSecretsInWorkflow`'
  parameters:
  - OSSRH_S01_USERNAME
  - SONATYPE_USERNAME
  - 'null'
  sources:
  - before: |
      name: Publish
      jobs:
        build:
          secrets:
            ossrh_username: ${{ secrets.OSSRH_S01_USERNAME }}
            ossrh_token: ${{ secrets.OSSRH_S01_TOKEN }}
          steps:
            - name: Publish to Maven Central
              env:
                MAVEN_USERNAME: ${{ secrets.OSSRH_S01_USERNAME }}
    after: |
      name: Publish
      jobs:
        build:
          secrets:
            ossrh_username: ${{ secrets.SONATYPE_USERNAME }}
            ossrh_token: ${{ secrets.OSSRH_S01_TOKEN }}
          steps:
            - name: Publish to Maven Central
              env:
                MAVEN_USERNAME: ${{ secrets.SONATYPE_USERNAME }}
    path: .github/workflows/publish.yml
    language: yaml
---
type: specs.openrewrite.org/v1beta/example
recipeName: org.openrewrite.github.SetupJavaAdoptOpenJDKToTemurin
examples:
- description: '`SetupJavaAdoptOpenJDKToTemurinTest#actionsSetupJavaAdoptOpenJDKToTemurin`'
  sources:
  - before: |
      jobs:
        build:
          steps:
            - uses: actions/checkout@v2
              with:
                fetch-depth: 0
            - name: set-up-jdk-0
              uses: actions/setup-java@v2.3.0
              with:
                distribution: "adopt"
                java-version: "11"
            - name: set-up-jdk-1
              uses: actions/setup-java@v2.3.0
              with:
                distribution: "adopt-hotspot"
                java-version: "11"
            - name: set-up-jdk-2
              uses: actions/setup-java@v2.3.0
              with:
                distribution: "adopt-openj9"
                java-version: "11"
            - name: build
              run: ./gradlew build test
    after: |
      jobs:
        build:
          steps:
            - uses: actions/checkout@v2
              with:
                fetch-depth: 0
            - name: set-up-jdk-0
              uses: actions/setup-java@v2.3.0
              with:
                distribution: "temurin"
                java-version: "11"
            - name: set-up-jdk-1
              uses: actions/setup-java@v2.3.0
              with:
                distribution: "temurin"
                java-version: "11"
            - name: set-up-jdk-2
              uses: actions/setup-java@v2.3.0
              with:
                distribution: "adopt-openj9"
                java-version: "11"
            - name: build
              run: ./gradlew build test
    path: .github/workflows/ci.yml
    language: yaml
---
type: specs.openrewrite.org/v1beta/example
recipeName: org.openrewrite.github.SetupJavaAdoptOpenj9ToSemeru
examples:
- description: '`SetupJavaAdoptOpenj9ToSemeruTest#actionsSetupJavaAdoptOpenJDKToTemurin`'
  sources:
  - before: |
      jobs:
        build:
          steps:
            - uses: actions/checkout@v2
              with:
                fetch-depth: 0
            - name: set-up-jdk-0
              uses: actions/setup-java@v2.3.0
              with:
                distribution: "adopt"
                java-version: "11"
            - name: set-up-jdk-1
              uses: actions/setup-java@v2.3.0
              with:
                distribution: "adopt-hotspot"
                java-version: "11"
            - name: set-up-jdk-2
              uses: actions/setup-java@v2.3.0
              with:
                distribution: "adopt-openj9"
                java-version: "11"
            - name: build
              run: ./gradlew build test
    after: |
      jobs:
        build:
          steps:
            - uses: actions/checkout@v2
              with:
                fetch-depth: 0
            - name: set-up-jdk-0
              uses: actions/setup-java@v2.3.0
              with:
                distribution: "adopt"
                java-version: "11"
            - name: set-up-jdk-1
              uses: actions/setup-java@v2.3.0
              with:
                distribution: "adopt-hotspot"
                java-version: "11"
            - name: set-up-jdk-2
              uses: actions/setup-java@v2.3.0
              with:
                distribution: "semeru"
                java-version: "11"
            - name: build
              run: ./gradlew build test
    path: .github/workflows/ci.yml
    language: yaml
---
type: specs.openrewrite.org/v1beta/example
recipeName: org.openrewrite.github.SetupJavaUpgradeJavaVersion
examples:
- description: '`SetupJavaUpgradeJavaVersionTest#updatesOldMajorVersion`'
  parameters:
  - '21'
  sources:
  - before: |
      jobs:
        build:
          steps:
            - uses: actions/checkout@v2
              with:
                fetch-depth: 0
            - name: set-up-temurin-jdk
              uses: actions/setup-java@v2.3.0
              with:
                java-version: "11"
                distribution: temurin
            - name: set-up-zulu-jdk
              uses: actions/setup-java@v3
              with:
                java-version: "19"
                distribution: zulu
            - name: build
              run: ./gradlew build test
    after: |
      jobs:
        build:
          steps:
            - uses: actions/checkout@v2
              with:
                fetch-depth: 0
            - name: set-up-temurin-jdk
              uses: actions/setup-java@v2.3.0
              with:
                java-version: "21"
                distribution: temurin
            - name: set-up-zulu-jdk
              uses: actions/setup-java@v3
              with:
                java-version: "21"
                distribution: zulu
            - name: build
              run: ./gradlew build test
    path: .github/workflows/ci.yml
    language: yaml
---
type: specs.openrewrite.org/v1beta/example
recipeName: org.openrewrite.github.SetupNodeUpgradeNodeVersion
examples:
- description: '`SetupNodeUpgradeNodeVersionTest#upgradeNodeVersion`'
  parameters:
  - 'null'
  sources:
  - before: |
      name: CI
      on:
        pull_request:
      jobs:
        test:
          runs-on: ubuntu-latest
          steps:
            - uses: actions/checkout@v4
            - uses: actions/setup-node@v4
              with:
                node-version: '18'
            - run: npm ci
            - run: npm test
    after: |
      name: CI
      on:
        pull_request:
      jobs:
        test:
          runs-on: ubuntu-latest
          steps:
            - uses: actions/checkout@v4
            - uses: actions/setup-node@v4
              with:
                node-version: '24'
            - run: npm ci
            - run: npm test
    path: .github/workflows/ci.yml
    language: yaml
---
type: specs.openrewrite.org/v1beta/example
recipeName: org.openrewrite.github.SetupPythonToUv
examples:
- description: '`SetupPythonToUvTest#basicSetupPythonToUv`'
  parameters:
  - 'null'
  - 'null'
  - 'null'
  - 'null'
  sources:
  - before: |
      name: Test

      on: [push]

      jobs:
        test:
          runs-on: ubuntu-latest
          steps:
            - uses: actions/checkout@v4
            - uses: actions/setup-python@v5
              with:
                python-version: '3.11'
            - run: pip install -r requirements.txt
            - run: python -m pytest
    after: |
      name: Test

      on: [push]

      jobs:
        test:
          runs-on: ubuntu-latest
          steps:
            - uses: actions/checkout@v4
            - uses: astral-sh/setup-uv@v6
              with:
                python-version: '3.11'
            - run: uv sync
            - run: uv run pytest
    path: .github/workflows/test.yml
    language: yaml
---
type: specs.openrewrite.org/v1beta/example
recipeName: org.openrewrite.github.UpgradeSlackNotificationVersion2
examples:
- description: '`UpgradeSlackNotificationVersion2Test#updatesVersion2`'
  sources:
  - before: |
      jobs:
        build:
          steps:
            - name: Send notification on error
              if: failure() && inputs.send-notification
              uses: slackapi/slack-github-action@v1.27.0
              with:
                channel-id: "##foo-alerts"
                slack-message: ":boom: Unable run dependency check on: <${{ steps.get_failed_check_link.outputs.failed-check-link }}|${{ inputs.organization }}/${{ inputs.repository }}>"
              env:
                SLACK_BOT_TOKEN: ${{ secrets.SLACK_MORTY_BOT_TOKEN }}
    after: |
      jobs:
        build:
          steps:
            - name: Send notification on error
              if: failure() && inputs.send-notification
              uses: slackapi/slack-github-action@v2.0.0
              with:
                method: chat.postMessage
                token: ${{ secrets.SLACK_MORTY_BOT_TOKEN }}
                payload: |
                  channel: "##foo-alerts"
                  text: ":boom: Unable run dependency check on: <${{ steps.get_failed_check_link.outputs.failed-check-link }}|${{ inputs.organization }}/${{ inputs.repository }}>"
    path: .github/workflows/ci.yml
    language: yaml
---
type: specs.openrewrite.org/v1beta/example
recipeName: org.openrewrite.github.security.AnonymousJobsRecipe
examples:
- description: '`AnonymousJobsRecipeTest#shouldFlagJobWithoutName`'
  sources:
  - before: |
      name: Test Workflow
      on: push
      jobs:
        test:
          runs-on: ubuntu-latest
          steps:
            - uses: actions/checkout@v4
        build:
          name: Build application
          runs-on: ubuntu-latest
          steps:
            - run: echo "building"
    after: |
      name: Test Workflow
      on: push
      jobs:
        ~~(Job has no name. Add a descriptive name to make it easier to identify in workflow runs.)~~>test:
          runs-on: ubuntu-latest
          steps:
            - uses: actions/checkout@v4
        build:
          name: Build application
          runs-on: ubuntu-latest
          steps:
            - run: echo "building"
    path: .github/workflows/test.yml
    language: yaml
---
type: specs.openrewrite.org/v1beta/example
recipeName: org.openrewrite.github.security.ArtifactSecurityRecipe
examples:
- description: '`ArtifactSecurityRecipeTest#shouldFlagCredentialPersistenceRisk`'
  sources:
  - before: |
      name: Build and Upload
      on: push
      jobs:
        build:
          runs-on: ubuntu-latest
          steps:
            - uses: actions/checkout@v4
            - uses: actions/upload-artifact@v3
              with:
                name: build-output
                path: |
                  ~/.ssh/
                  ~/.gitconfig
                  ~/.aws/
    after: |
      name: Build and Upload
      on: push
      jobs:
        build:
          runs-on: ubuntu-latest
          steps:
            - ~~(Checkout step does not disable credential persistence, which may expose credentials in artifacts.)~~>uses: actions/checkout@v4
            - ~~(Uploading potentially sensitive paths that may contain credentials or configuration files.)~~>uses: actions/upload-artifact@v3
              with:
                name: build-output
                path: |
                  ~/.ssh/
                  ~/.gitconfig
                  ~/.aws/
    path: .github/workflows/build.yml
    language: yaml
---
type: specs.openrewrite.org/v1beta/example
recipeName: org.openrewrite.github.security.BotConditionsRecipe
examples:
- description: '`BotConditionsRecipeTest#shouldFlagSpoofableActorNameCheck`'
  sources:
  - before: |
      name: Test Workflow
      on: pull_request
      jobs:
        test:
          runs-on: ubuntu-latest
          if: github.actor == 'dependabot[bot]'
          steps:
            - uses: actions/checkout@v4
    after: |
      name: Test Workflow
      on: pull_request
      jobs:
        test:
          runs-on: ubuntu-latest
          ~~(Bot actor name check is spoofable. Consider using actor_id instead for more secure bot validation.)~~>if: github.actor == 'dependabot[bot]'
          steps:
            - uses: actions/checkout@v4
    path: .github/workflows/test.yml
    language: yaml
---
type: specs.openrewrite.org/v1beta/example
recipeName: org.openrewrite.github.security.CachePoisoningRecipe
examples:
- description: '`CachePoisoningRecipeTest#shouldDetectCacheInReleaseWorkflow`'
  sources:
  - before: |
      on: release
      jobs:
        publish:
          runs-on: ubuntu-latest
          steps:
            - uses: actions/checkout@v4
            - uses: actions/cache@v4
              with:
                path: ~/.cargo
                key: cargo-${{ hashFiles('Cargo.lock') }}
            - uses: softprops/action-gh-release@v1
              with:
                files: dist/*
    after: |
      on: release
      jobs:
        publish:
          runs-on: ubuntu-latest
          steps:
            - uses: actions/checkout@v4
            - ~~(Action 'actions/cache' uses caching in a workflow that publishes artifacts. This could lead to cache poisoning where malicious content gets cached and included in published artifacts. Consider disabling caching for this step or using read-only cache mode.)~~>uses: actions/cache@v4
              with:
                path: ~/.cargo
                key: cargo-${{ hashFiles('Cargo.lock') }}
            - uses: softprops/action-gh-release@v1
              with:
                files: dist/*
    path: .github/workflows/test.yml
    language: yaml
---
type: specs.openrewrite.org/v1beta/example
recipeName: org.openrewrite.github.security.DangerousTriggersRecipe
examples:
- description: '`DangerousTriggersRecipeTest#shouldDetectPullRequestTarget`'
  sources:
  - before: |
      on: pull_request_target
      jobs:
        test:
          runs-on: ubuntu-latest
          steps:
            - run: echo "test"
    after: |
      ~~(The 'pull_request_target' trigger is almost always used insecurely. It runs with write permissions in the context of the target repository, potentially allowing code injection from pull requests. Consider using 'pull_request' instead, or implement proper isolation.)~~>on: pull_request_target
      jobs:
        test:
          runs-on: ubuntu-latest
          steps:
            - run: echo "test"
    path: .github/workflows/test.yml
    language: yaml
---
type: specs.openrewrite.org/v1beta/example
recipeName: org.openrewrite.github.security.ExcessivePermissionsRecipe
examples:
- description: '`ExcessivePermissionsRecipeTest#shouldFlagWriteAllPermissions`'
  sources:
  - before: |
      name: Test Workflow
      on: push
      permissions: write-all
      jobs:
        test:
          runs-on: ubuntu-latest
          steps:
            - uses: actions/checkout@v4
    after: |
      name: Test Workflow
      on: push
      ~~(Uses 'write-all' permissions which grants excessive access. Consider using specific permissions instead.)~~>permissions: write-all
      jobs:
        test:
          runs-on: ubuntu-latest
          steps:
            - uses: actions/checkout@v4
    path: .github/workflows/test.yml
    language: yaml
---
type: specs.openrewrite.org/v1beta/example
recipeName: org.openrewrite.github.security.ForbiddenUsesRecipe
examples:
- description: '`ForbiddenUsesRecipeTest#shouldFlagDangerousAction`'
  sources:
  - before: |
      name: Test Workflow
      on: push
      jobs:
        test:
          runs-on: ubuntu-latest
          steps:
            - uses: actions/checkout@v1
              name: Checkout code
    after: |
      name: Test Workflow
      on: push
      jobs:
        test:
          runs-on: ubuntu-latest
          steps:
            - ~~(Action 'actions/checkout@v1' is known to have security vulnerabilities. Consider upgrading to a more recent version or using an alternative.)~~>uses: actions/checkout@v1
              name: Checkout code
    path: .github/workflows/test.yml
    language: yaml
---
type: specs.openrewrite.org/v1beta/example
recipeName: org.openrewrite.github.security.GitHubEnvRecipe
examples:
- description: '`GitHubEnvRecipeTest#shouldDetectGitHubEnvInPullRequestTarget`'
  sources:
  - before: |
      on: pull_request_target
      jobs:
        test:
          runs-on: ubuntu-latest
          steps:
            - uses: actions/checkout@v4
            - name: Set environment
              run: |
                echo "BRANCH_NAME=${{ github.head_ref }}" >> $GITHUB_ENV
                echo "Building branch: $BRANCH_NAME"
    after: |
      on: pull_request_target
      jobs:
        test:
          runs-on: ubuntu-latest
          steps:
            - uses: actions/checkout@v4
            - name: Set environment
              ~~(Write to GITHUB_ENV may allow code execution in a workflow with dangerous triggers. This can lead to code injection when the written content includes user-controlled data. Ensure any dynamic content is properly sanitized or avoid writing to environment files in workflows triggered by untrusted events.)~~>run: |
                echo "BRANCH_NAME=${{ github.head_ref }}" >> $GITHUB_ENV
                echo "Building branch: $BRANCH_NAME"
    path: .github/workflows/test.yml
    language: yaml
---
type: specs.openrewrite.org/v1beta/example
recipeName: org.openrewrite.github.security.HardcodedCredentialsRecipe
examples:
- description: '`HardcodedCredentialsRecipeTest#shouldDetectHardcodedContainerPassword`'
  sources:
  - before: |
      on: push
      jobs:
        test:
          runs-on: ubuntu-latest
          container:
            image: my-registry/image:latest
            credentials:
              username: user
              password: hardcoded-password
          steps:
            - run: echo "test"
    after: |
      on: push
      jobs:
        test:
          runs-on: ubuntu-latest
          container:
            image: my-registry/image:latest
            credentials:
              username: user
              ~~(Container registry password 'hardcoded-password' appears to be hardcoded. Use secrets (e.g., ${{ secrets.REGISTRY_PASSWORD }}) instead.)~~>password: hardcoded-password
          steps:
            - run: echo "test"
    path: .github/workflows/test.yml
    language: yaml
---
type: specs.openrewrite.org/v1beta/example
recipeName: org.openrewrite.github.security.InsecureCommandsRecipe
examples:
- description: '`InsecureCommandsRecipeTest#shouldDetectInsecureCommandsAtWorkflowLevel`'
  sources:
  - before: |
      on: push
      env:
        ACTIONS_ALLOW_UNSECURE_COMMANDS: true
        OTHER_VAR: value
      jobs:
        test:
          runs-on: ubuntu-latest
          steps:
            - run: echo "test"
    after: |
      on: push
      env:
        ~~(Insecure commands are enabled via ACTIONS_ALLOW_UNSECURE_COMMANDS. This allows dangerous workflow commands that can lead to code injection. Remove this environment variable to disable insecure commands.)~~>ACTIONS_ALLOW_UNSECURE_COMMANDS: true
        OTHER_VAR: value
      jobs:
        test:
          runs-on: ubuntu-latest
          steps:
            - run: echo "test"
    path: .github/workflows/test.yml
    language: yaml
---
type: specs.openrewrite.org/v1beta/example
recipeName: org.openrewrite.github.security.ObfuscationRecipe
examples:
- description: '`ObfuscationRecipeTest#shouldFlagObfuscatedUsesWithDot`'
  sources:
  - before: |
      name: Test Workflow
      on: push
      jobs:
        test:
          runs-on: ubuntu-latest
          steps:
            - uses: actions/checkout/./action@v4
    after: |
      name: Test Workflow
      on: push
      jobs:
        test:
          runs-on: ubuntu-latest
          steps:
            - ~~(Action reference contains obfuscated path components that may hide the actual action being used.)~~>uses: actions/checkout/./action@v4
    path: .github/workflows/test.yml
    language: yaml
---
type: specs.openrewrite.org/v1beta/example
recipeName: org.openrewrite.github.security.RefVersionMismatchRecipe
examples:
- description: '`RefVersionMismatchRecipeTest#shouldFlagMismatchedVersionComment`'
  sources:
  - before: |
      name: Test Workflow
      on: push
      jobs:
        test:
          runs-on: ubuntu-latest
          steps:
            # tag=v3
            - uses: actions/checkout@8ade135a41bc03ea155e62e844d188df1ea18608
    after: |
      name: Test Workflow
      on: push
      jobs:
        test:
          runs-on: ubuntu-latest
          steps:
            # tag=v3
            - ~~(Action is pinned to a commit SHA but has a version comment that may not match. Verify the comment reflects the actual pinned version.)~~>uses: actions/checkout@8ade135a41bc03ea155e62e844d188df1ea18608
    path: .github/workflows/test.yml
    language: yaml
---
type: specs.openrewrite.org/v1beta/example
recipeName: org.openrewrite.github.security.SecretsInheritRecipe
examples:
- description: '`SecretsInheritRecipeTest#shouldDetectSecretsInherit`'
  sources:
  - before: |
      on: push
      jobs:
        call-workflow:
          uses: ./.github/workflows/reusable.yml
          secrets: inherit
          with:
            environment: production
    after: |
      on: push
      jobs:
        call-workflow:
          uses: ./.github/workflows/reusable.yml
          ~~(This reusable workflow unconditionally inherits all parent secrets. Consider explicitly passing only the required secrets to follow the principle of least privilege and reduce the risk of secret exposure to called workflows.)~~>secrets: inherit
          with:
            environment: production
    path: .github/workflows/test.yml
    language: yaml
---
type: specs.openrewrite.org/v1beta/example
recipeName: org.openrewrite.github.security.SelfHostedRunnerRecipe
examples:
- description: '`SelfHostedRunnerRecipeTest#shouldFlagSelfHostedRunner`'
  sources:
  - before: |
      name: Test Workflow
      on: push
      jobs:
        test:
          runs-on: [self-hosted, linux, x64]
          steps:
            - uses: actions/checkout@v4
    after: |
      name: Test Workflow
      on: push
      jobs:
        test:
          ~~(Uses self-hosted runner which may have security implications in public repositories. Ensure runners are ephemeral and properly isolated.)~~>runs-on: [self-hosted, linux, x64]
          steps:
            - uses: actions/checkout@v4
    path: .github/workflows/test.yml
    language: yaml
---
type: specs.openrewrite.org/v1beta/example
recipeName: org.openrewrite.github.security.TemplateInjectionRecipe
examples:
- description: '`TemplateInjectionRecipeTest#shouldFlagPullRequestTitleInjection`'
  sources:
  - before: |
      name: Test Workflow
      on: pull_request_target
      jobs:
        test:
          runs-on: ubuntu-latest
          steps:
            - run: 'echo "PR Title: ${{ github.event.pull_request.title }}"'
    after: |
      name: Test Workflow
      on: pull_request_target
      jobs:
        test:
          runs-on: ubuntu-latest
          steps:
            - ~~(Potential template injection vulnerability. User-controlled input 'github.event.pull_request.title' used in run command without proper escaping.)~~>run: 'echo "PR Title: ${{ github.event.pull_request.title }}"'
    path: .github/workflows/test.yml
    language: yaml
---
type: specs.openrewrite.org/v1beta/example
recipeName: org.openrewrite.github.security.TrustedPublishingRecipe
examples:
- description: '`TrustedPublishingRecipeTest#shouldFlagPyPIPublishWithPassword`'
  sources:
  - before: |
      name: Publish to PyPI
      on: push
      jobs:
        publish:
          runs-on: ubuntu-latest
          steps:
            - uses: pypa/gh-action-pypi-publish@v1.5.0
              with:
                password: ${{ secrets.PYPI_API_TOKEN }}
                repository-url: https://upload.pypi.org/legacy/
    after: |
      name: Publish to PyPI
      on: push
      jobs:
        publish:
          runs-on: ubuntu-latest
          steps:
            - ~~(Uses manual credentials instead of trusted publishing. Consider using OIDC trusted publishing for better security.)~~>uses: pypa/gh-action-pypi-publish@v1.5.0
              with:
                ~~(Manual credential used here)~~>password: ${{ secrets.PYPI_API_TOKEN }}
                repository-url: https://upload.pypi.org/legacy/
    path: .github/workflows/publish.yml
    language: yaml
---
type: specs.openrewrite.org/v1beta/example
recipeName: org.openrewrite.github.security.UndocumentedPermissionsRecipe
examples:
- description: '`UndocumentedPermissionsRecipeTest#shouldFlagUndocumentedWorkflowPermissions`'
  sources:
  - before: |
      name: Test Workflow
      on: push
      permissions:
        contents: write
        packages: read
      jobs:
        test:
          runs-on: ubuntu-latest
          steps:
            - uses: actions/checkout@v4
    after: |
      name: Test Workflow
      on: push
      ~~(Permissions block lacks documentation comment. Consider adding a comment explaining why these permissions are needed for workflow.)~~>permissions:
        contents: write
        packages: read
      jobs:
        test:
          runs-on: ubuntu-latest
          steps:
            - uses: actions/checkout@v4
    path: .github/workflows/test.yml
    language: yaml
---
type: specs.openrewrite.org/v1beta/example
recipeName: org.openrewrite.github.security.UnpinnedActionsRecipe
examples:
- description: '`UnpinnedActionsRecipeTest#shouldFlagUnpinnedActionWithTagVersion`'
  sources:
  - before: |
      name: Test Workflow
      on: push
      jobs:
        test:
          runs-on: ubuntu-latest
          steps:
            - uses: actions/checkout@v4
              name: Checkout code
    after: |
      name: Test Workflow
      on: push
      jobs:
        test:
          runs-on: ubuntu-latest
          steps:
            - ~~(Action 'actions/checkout@v4' is not pinned to a commit SHA. Consider pinning to a specific commit for security and reproducibility.)~~>uses: actions/checkout@v4
              name: Checkout code
    path: .github/workflows/test.yml
    language: yaml
---
type: specs.openrewrite.org/v1beta/example
recipeName: org.openrewrite.github.security.UnpinnedDockerImagesRecipe
examples:
- description: '`UnpinnedDockerImagesRecipeTest#shouldFlagUnpinnedContainerImage`'
  sources:
  - before: |
      name: Test Workflow
      on: push
      jobs:
        test:
          runs-on: ubuntu-latest
          container:
            image: node:18
          steps:
            - uses: actions/checkout@v4
    after: |
      name: Test Workflow
      on: push
      jobs:
        test:
          runs-on: ubuntu-latest
          container:
            ~~(Docker image 'node:18' is not pinned to a digest. Consider pinning to a specific digest for security and reproducibility.)~~>image: node:18
          steps:
            - uses: actions/checkout@v4
    path: .github/workflows/test.yml
    language: yaml
