#
# Copyright 2025 the original author or authors.
# <p>
# Licensed under the Moderne Source Available License (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
# <p>
# https://docs.moderne.io/licensing/moderne-source-available-license
# <p>
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

---
type: specs.openrewrite.org/v1beta/recipe
name: org.openrewrite.github.AddManualTrigger
displayName: Add manual workflow trigger
description: You can manually trigger workflow runs. To trigger specific workflows in a repository, use the `workflow_dispatch` event.
preconditions:
  - org.openrewrite.Singleton
tags:
  - github
recipeList:
  - org.openrewrite.yaml.MergeYaml:
      key: $.on
      yaml: |-
        workflow_dispatch:
      acceptTheirs: true
      fileMatcher: '.github/workflows/*.{yml,yaml}'
---
type: specs.openrewrite.org/v1beta/recipe
name: org.openrewrite.github.DependabotCheckForGithubActionsUpdatesDaily
displayName: Check for github-actions updates daily
description: Set dependabot to check for github-actions updates daily.
preconditions:
  - org.openrewrite.Singleton
tags:
  - demo
  - dependabot
  - dependencies
  - github
recipeList:
  - org.openrewrite.github.ChangeDependabotScheduleInterval:
      packageEcosystem: github-actions
      interval: daily
---
type: specs.openrewrite.org/v1beta/recipe
name: org.openrewrite.github.DependabotCheckForGithubActionsUpdatesWeekly
displayName: Check for github-actions updates weekly
description: Set dependabot to check for github-actions updates weekly.
preconditions:
  - org.openrewrite.Singleton
tags:
  - demo
  - dependabot
  - dependencies
  - github
recipeList:
  - org.openrewrite.github.ChangeDependabotScheduleInterval:
      packageEcosystem: github-actions
      interval: weekly
---
type: specs.openrewrite.org/v1beta/recipe
name: org.openrewrite.github.FindGitHubActionSecretReferences
displayName: Find GitHub action secret references
description: Help identify and inventory your GitHub secrets that are being used in GitHub actions.
preconditions:
  - org.openrewrite.Singleton
recipeList:
  - org.openrewrite.text.Find:
      find: secrets\.\w*
      regex: "True"
      caseSensitive: "False"
      filePattern: "**/.github/workflows/**/*.yml;**/.github/workflows/**/*.yaml"

---
type: specs.openrewrite.org/v1beta/recipe
name: org.openrewrite.github.MigrateTibdexGitHubAppTokenToActions
displayName: Migrate from tibdex/github-app-token to actions/create-github-app-token
description: Migrates from tibdex/github-app-token@v2 to actions/create-github-app-token@v2 and updates parameter names from snake_case to kebab-case.
preconditions:
  - org.openrewrite.Singleton
tags:
  - github
  - actions
recipeList:
  - org.openrewrite.github.ChangeAction:
      oldAction: tibdex/github-app-token
      newAction: actions/create-github-app-token
      newVersion: v2
  - org.openrewrite.yaml.ChangeKey:
      oldKeyPath: $.jobs..[?(@.uses =~ 'actions/create-github-app-token.*')].with.app_id
      newKey: app-id
  - org.openrewrite.yaml.ChangeKey:
      oldKeyPath: $.jobs..[?(@.uses =~ 'actions/create-github-app-token.*')].with.private_key
      newKey: private-key
  - org.openrewrite.yaml.MergeYaml:
      key: $.jobs..[?(@.uses =~ 'actions/create-github-app-token.*')].with
      yaml: |-
        owner: ${{ github.repository_owner }}
      acceptTheirs: false
      fileMatcher: '.github/workflows/*.{yml,yaml}'

---
type: specs.openrewrite.org/v1beta/recipe
name: org.openrewrite.github.MigrateSetupUvV6ToV7
displayName: Migrate `astral-sh/setup-uv` from v6 to v7
description: Migrates `astral-sh/setup-uv` from v6 to v7. Updates the action version and removes the deprecated `server-url` input. See the [v7.0.0 release notes](https://github.com/astral-sh/setup-uv/releases/tag/v7.0.0) for breaking changes.
preconditions:
  - org.openrewrite.Singleton
tags:
  - github
  - actions
recipeList:
  - org.openrewrite.github.ChangeActionVersion:
      action: astral-sh/setup-uv
      version: v7
  - org.openrewrite.yaml.DeleteKey:
      keyPath: $.jobs..[?(@.uses =~ 'astral-sh/setup-uv@v7.*')].with.server-url
